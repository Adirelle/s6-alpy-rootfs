#!/bin/execlineb -P

define BASE /etc/s6-rc
define COMPILED ${BASE}/compiled

backtick -n OLD { s6-linkname ${COMPILED} }
backtick -n NEW { s6-uniquename ${COMPILED} }

multisubstitute {
	import -u OLD
	import -u NEW
	importas V S6_VERBOSITY
}

if { s6-rc-compile -v${V} ${NEW} ${BASE}/source }
if { ln -snf ${NEW} ${COMPILED} }
if { s6-rc-update -v${V} -t5000 ${NEW} }
s6-rmrf ${OLD}

