#!/bin/execlineb -P

import -ui interface

if {
	import -ui ip
	foreground { s6-echo "Address: ${ip}" }
	ifconfig ${interface} ${ip}
}

foreground {
	import -ui subnet
	foreground { s6-echo "Netmask: ${subnet}" }
	ifconfig ${interface} netmask ${subnet}
}

foreground {
	import -ui broadcast
	foreground { s6-echo "Broadcast: ${broadcast}" }
	ifconfig ${interface} broadcast ${broadcast}
}

foreground {
	import -ui router
	foreground { s6-echo "Router: ${router}" }
	if { clear-routes 0.0.0.0 }
	ip route add default via ${router} dev ${interface} metric 1024
}

foreground {
	import -us -D "" dns
	foreground { s6-echo "Nameservers: $dns" }
	/etc/s6-rc/scripts/set-revolvconf-fragment 50-dhcp-${interface}-ns "nameserver ${dns}"
}

fdmove 1 3
foreground { s6-echo done }
fdclose 3

exit 0
